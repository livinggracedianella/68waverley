---
import { strapiAsset, parseDate } from '@rkn/page-components'
const { message } = Astro.props
const {
  title,
  date,
  slug,
  profiles,
  featureImage,
  soundcloudRecording,
  oneLiner,
} = message?.data?.attributes ?? message?.attributes ?? message
const { caption } = featureImage ?? ''
const { url, width, height } = featureImage?.image.data.attributes.formats
  .small ?? {
  url: '/uploads/small_Sermon_Image_Background_ed63796e21.png',
  width: 208,
  height: 156,
}
const embedCode = soundcloudRecording.embedCode
const iframeUrl = embedCode
  ?.match(`src="([^"]+)"`)?.[1]
  .replace('visual=true', 'visual=false')
---

<div class="flex-row full-width">
  <div class="container">
    <h2>
      {Astro.params.page === slug ? '' : 'Featured'} Message: <a
        class="heading"
        href={`/messages/${slug}/`}>{title}</a
      >
    </h2>
    <div class="flex-row">
      <div>
        <p class="h3">{parseDate(date)}</p>
        <p class="h3 column">
          {
            profiles.data.map((p) => (
              <a href={`/profiles/${p.attributes.slug}`}>{p.attributes.name}</a>
            ))
          }
        </p>
      </div>
      <p class="description">{oneLiner}</p>
    </div>
    <div class="soundcloud">
      <iframe
        width="100%"
        height="200"
        scrolling="no"
        frameborder="no"
        allow="autoplay"
        src={iframeUrl}
        show_artwork="false"></iframe>
    </div>
  </div>
  <img src={strapiAsset(url)} width={width} height={height} alt={caption} />
</div>

<style>
  a.heading {
    font-size: var(--font-size-h2);
  }
  div.flex-row {
    display: flex;
    width: 100%;
  }
  div.container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    width: 100%;
    max-width: 700px;
    margin: 0 auto;
  }
  .h3,
  .h3 a {
    font-size: var(--font-size-h3);
    font-family: var(--bold);
  }
  div.full-width {
    width: 100vw;
  }
  .soundcloud {
    width: 100%;
  }
  h2 {
    margin-right: auto;
  }
  .description {
    padding-left: 20px;
  }
  .column {
    display: flex;
    flex-direction: column;
  }
  @media (max-width: 1023px) {
    img {
      display: none;
    }
  }
</style>
