---
import { strapiAsset, parseDate } from '@rkn/page-components'
const { message } = Astro.props
const { title, date, slug, providers, feature_image, soundcloud_recording } =
  message?.data?.attributes ?? message?.attributes ?? message
const { caption } = feature_image ?? ''
const { url, width, height } = feature_image?.image.data.attributes.formats
  .small ?? {
  url: '/uploads/small_Sermon_Image_Background_ed63796e21.png',
  width: 500,
  height: 375,
}
const embedCode = soundcloud_recording.embed_code
const iframeUrl = embedCode
  ?.match(`src="([^"]+)"`)?.[1]
  .replace('visual=true', 'visual=false')
---

<div>
  <h2>
    {Astro.params.page === slug ? '' : 'Featured'} Message: <a
      class="heading"
      href={`/messages/${slug}/`}>{title}</a
    >
  </h2>
  <p>{parseDate(date)}</p>
  <p>{providers.data.map((p) => p.attributes.name)}</p>
  <img src={strapiAsset(url)} width={width} height={height} alt={caption} />
  <div class="soundcloud">
    <iframe
      width="100%"
      height="200"
      scrolling="no"
      frameborder="no"
      allow="autoplay"
      src={iframeUrl}
      show_artwork="false"></iframe>
  </div>
</div>

<style>
  a.heading {
    font-size: var(--font-size-h2);
  }
</style>
