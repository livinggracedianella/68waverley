---
import { BaseLayout } from '@rkn/base-components'
import SinglePostItem from '../../components/SinglePostItem.astro'

export async function getStaticPaths() {
  const { data: posts } = await fetch(
    `${import.meta.env.STRAPI_HOST}/api/posts?filters[websites][key][$eq]=${
      import.meta.env.THIS_SITE
    }`
  ).then((res) => res.json())
  return posts.map((post) => ({ params: { slug: post.attributes.slug } }))
}

const { slug } = Astro.params
const { data: postItem } = await fetch(
  `${import.meta.env.STRAPI_HOST}/api/posts?filters[slug][$eq]=${slug}`
).then((x) => x.json())
---

<BaseLayout title={postItem[0]?.title}>
  <SinglePostItem post={postItem[0]} />
</BaseLayout>
