---
import BaseLayout from '../layouts/LivingGraceBaseLayout.astro'
import { BlockRenderer, Header, fetchPageData } from '@rkn/page-components'
import qs from 'qs'

export async function getStaticPaths() {
  const pages = await fetch(`${import.meta.env.STRAPI_HOST}/api/pages`).then(
    (res) => res.json()
  )
  return pages.data.map((page) => ({ params: { page: page.attributes.slug } }))
}
const { page } = Astro.params
const pageData = await fetch(
  `${import.meta.env.STRAPI_HOST}/api/pages?${qs.stringify({
    filters: {
      slug: {
        $eq: page,
      },
    },
    populate: [
      'header.header_image',
      'blocks.image',
      'blocks.gatherings',
      'blocks.message',
      'blocks.message.feature_image',
      'blocks.message.feature_image.image',
      'blocks.message.soundcloud_recording',
      'blocks.message.providers',
      'blocks.post',
      'blocks.post.providers',
      'blocks.post.featured_image',
      'blocks.post.featured_image.image',
      'blocks.event',
      'blocks.profiles',
      'blocks.profiles.providers',
    ],
  })}`
).then((res) => res.json())
const blocks = pageData.data[0].attributes.blocks
const header = pageData.data[0].attributes.header
---

<BaseLayout title="Styleguide">
  <div class="outer">
    <Header {...header} />
    <div class="inner">
      <BlockRenderer blocks={blocks} />
    </div>
  </div>
  <style>
    div.outer {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    div.inner {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      max-width: 700px;
    }
  </style>
</BaseLayout>
